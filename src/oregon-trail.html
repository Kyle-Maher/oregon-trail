<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oregon Trail</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier New', monospace;
            background: #2a1810;
            color: #f4e8d0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 700px;
            width: 100%;
            background: #3d2817;
            border: 4px solid #6b4423;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        h1 {
            text-align: center;
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stats {
            background: #2a1810;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 2px solid #6b4423;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .stat-label { color: #ffd700; }

        .landmark-indicator {
            background: #1a0f08;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 2px solid #ffd700;
            text-align: center;
            font-weight: bold;
            color: #ffd700;
        }

        .message-box {
            background: #1a0f08;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            min-height: 120px;
            border: 2px solid #6b4423;
            line-height: 1.6;
            white-space: pre-line;
        }

        .buttons { display: flex; flex-direction: column; gap: 10px; }

        button {
            background: #6b4423;
            color: #f4e8d0;
            border: 2px solid #8b5a3c;
            padding: 12px 20px;
            font-size: 1.1em;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
        }

        button:hover {
            background: #8b5a3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        button:disabled {
            background: #4a3020;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .game-over { text-align: center; font-size: 1.3em; color: #ff6b6b; }
        .victory { text-align: center; font-size: 1.3em; color: #51cf66; }

        .progress-bar {
            background: #1a0f08;
            height: 25px;
            border-radius: 5px;
            overflow: visible;
            margin-bottom: 20px;
            border: 2px solid #6b4423;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #6b4423, #8b5a3c);
            height: 100%;
            transition: width 0.5s;
            position: absolute;
            left: 0;
            top: 0;
        }

        .progress-label {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            color: #f4e8d0;
            z-index: 1;
        }

        .landmark-marker {
            position: absolute;
            top: -5px;
            width: 3px;
            height: 35px;
            z-index: 2;
            transform: translateX(-50%);
        }

        .marker-fort { background: #d4af37; box-shadow: 0 0 5px #d4af37; }
        .marker-river { background: #4a90e2; box-shadow: 0 0 5px #4a90e2; }

        .marker-icon {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .river-crossing { background: #1e3a5f; border-color: #4a90e2; }
        .fort-stop { background: #5f4a1e; border-color: #d4af37; }

        .choice-button { background: #4a6fa5; border-color: #6b8fc9; }
        .choice-button:hover { background: #5a7fb5; }

        .landmark-choice { background: #2c4a6b; border-color: #4a90e2; }

        /* Flip Animation Container */
        .flip-container { perspective: 1000px; width: 100%; }

        .flip-inner {
            position: relative;
            width: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flip-inner.flipped { transform: rotateY(180deg); }

        .main-game-content,
        .hunting-game,
        .river-game {
            width: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .main-game-content { position: relative; }

        .hunting-game,
        .river-game {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotateY(180deg);
            background: #3d2817;
            padding: 20px;
            border-radius: 8px;
        }

        .hunting-title, .river-title {
            text-align: center;
            color: #ffd700;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .hunting-instructions, .river-instructions {
            text-align: center;
            margin-bottom: 15px;
            color: #f4e8d0;
            line-height: 1.5;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-width: 350px;
            margin: 0 auto 20px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: #4a90e2;
            border: 2px solid #2a5a8a;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .grid-cell:hover { transform: scale(1.05); }
        .grid-cell.lit { background: #ffffff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        .grid-cell.correct { background: #51cf66; border-color: #2a8a3a; }
        .grid-cell.wrong { background: #ff6b6b; border-color: #8a2a2a; }
        .grid-cell.disabled { cursor: not-allowed; opacity: 0.5; }

        .hunting-status, .river-status {
            text-align: center;
            font-size: 1.1em;
            color: #ffd700;
            min-height: 30px;
            margin-bottom: 10px;
        }

        .hunting-score {
            text-align: center;
            font-size: 1em;
            color: #f4e8d0;
            margin-bottom: 15px;
        }

        /* River Crossing Game Styles */
        .river-scene {
            width: 100%;
            height: 300px;
            background: linear-gradient(to bottom, #87ceeb 0%, #4a90e2 50%, #2a5a8a 100%);
            border: 3px solid #2a5a8a;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .river-bank-left, .river-bank-right {
            position: absolute;
            bottom: 0;
            width: 80px;
            height: 100%;
            background: linear-gradient(to right, #6b4423, #8b5a3c);
        }

        .river-bank-left { left: 0; }
        .river-bank-right { right: 0; }

        .wagon {
            position: absolute;
            bottom: 50px;
            width: 60px;
            height: 40px;
            transition: left 0.1s linear;
            z-index: 10;
        }

        .wagon-body {
            width: 100%;
            height: 30px;
            background: #8b5a3c;
            border: 2px solid #6b4423;
            border-radius: 5px;
            position: relative;
        }

        .wagon-cover {
            position: absolute;
            top: -15px;
            left: 5px;
            right: 5px;
            height: 20px;
            background: #f4e8d0;
            border: 2px solid #6b4423;
            border-radius: 10px 10px 0 0;
        }

        .wagon-wheel {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #4a3020;
            border: 2px solid #2a1810;
            border-radius: 50%;
            bottom: -8px;
        }

        .wheel-left { left: 5px; }
        .wheel-right { right: 5px; }

        .current-indicator {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .current-wave {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: wave-flow 2s linear infinite;
        }

        @keyframes wave-flow {
            0% { left: -30px; opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { left: 100%; opacity: 0; }
        }

        .safe-zone {
            position: absolute;
            left: 50%;
            top: 40%;
            transform: translateX(-50%);
            width: 100px;
            height: 80px;
            background: rgba(81, 207, 102, 0.3);
            border: 3px dashed #51cf66;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            animation: pulse-safe 1s ease-in-out infinite;
        }

        @keyframes pulse-safe {
            0%, 100% { opacity: 0.4; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.7; transform: translateX(-50%) scale(1.05); }
        }

        .danger-zone {
            background: rgba(255, 107, 107, 0.3);
            border: 3px dashed #ff6b6b;
            animation: pulse-danger 0.8s ease-in-out infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .river-button { background: #4a90e2; border-color: #2a5a8a; font-size: 1.2em; padding: 15px 30px; }
        .river-button:hover { background: #5a9ff2; }
        .river-button:disabled { background: #2a5a8a; }

        .river-info {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            font-size: 0.95em;
        }

        .river-info-label { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üêÇ THE OREGON TRAIL üêÇ</h1>

        <div class="flip-container">
            <div class="flip-inner" id="flipInner">
                <!-- Main Game Content (Front) -->
                <div class="main-game-content">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                        <div class="progress-label" id="progressLabel">0 miles</div>
                        <div id="landmarkMarkers"></div>
                    </div>

                    <div class="landmark-indicator" id="landmarkIndicator">
                        Starting Point: Independence, Missouri
                    </div>

                    <div class="stats">
                        <div class="stat-row"><span class="stat-label">Distance:</span><span id="distance">0 / 2000 miles</span></div>
                        <div class="stat-row"><span class="stat-label">Food:</span><span id="food">100 lbs</span></div>
                        <div class="stat-row"><span class="stat-label">Health:</span><span id="health">100%</span></div>
                        <div class="stat-row"><span class="stat-label">Money:</span><span id="money">$50</span></div>
                        <div class="stat-row"><span class="stat-label">Oxen:</span><span id="oxen">2</span></div>
                    </div>

                    <div class="message-box" id="messageBox">
                        Welcome to the Oregon Trail! You are starting your journey from Independence, Missouri to Oregon City. It's a long 2000 mile journey. Manage your resources wisely and make it safely to Oregon!
                    </div>

                    <div class="buttons" id="actionButtons">
                        <button onclick="travel()">Continue on Trail</button>
                        <button onclick="rest()">Rest (Recover Health)</button>
                        <button onclick="hunt()">Hunt for Food</button>
                        <button onclick="trade()" id="tradeButton" disabled>Trade at Fort</button>
                    </div>
                </div>

                <!-- Hunting Mini-Game (Back) -->
                <div class="hunting-game" id="huntingGame" style="display: none;">
                    <div class="hunting-title">üéØ HUNTING üéØ</div>
                    <div class="hunting-instructions" id="huntingInstructions">
                        Watch the pattern carefully!
                    </div>
                    <div class="hunting-status" id="huntingStatus"></div>
                    <div class="hunting-score" id="huntingScore">Pattern Length: 5</div>
                    <div class="grid-container" id="gridContainer"></div>
                </div>

                <!-- River Crossing Mini-Game (Back) -->
                <div class="river-game" id="riverGame" style="display: none;">
                    <div class="river-title">üåä FORD THE RIVER üåä</div>
                    <div class="river-instructions" id="riverInstructions">
                        Click "CROSS!" when your wagon is in the GREEN ZONE!
                    </div>
                    <div class="river-info" id="riverInfo"></div>

                    <div class="river-scene" id="riverScene">
                        <div class="river-bank-left"></div>
                        <div class="river-bank-right"></div>
                        <div class="current-indicator" id="currentIndicator"></div>
                        <div class="safe-zone" id="crossingZone">‚úì</div>
                        <div class="wagon" id="wagon">
                            <div class="wagon-cover"></div>
                            <div class="wagon-body">
                                <div class="wagon-wheel wheel-left"></div>
                                <div class="wagon-wheel wheel-right"></div>
                            </div>
                        </div>
                    </div>

                    <div class="river-status" id="riverStatus">Get ready...</div>

                    <div class="buttons">
                        <button class="river-button" id="crossButton" onclick="attemptCrossing()" disabled>
                            CROSS!
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            distance: 0,
            food: 100,
            health: 100,
            money: 50,
            oxen: 2,
            day: 1,
            gameOver: false,
            currentLandmark: null,
            atFort: false,
            atRiver: false,
            awaitingChoice: false,
            visitedLandmarks: [],
            riverWaterLevels: {},
            currentRiverName: null,
            currentStrength: null
        };

        const GOAL_DISTANCE = 2000;

        // Landmarks along the trail
        const landmarks = [
            { name: "Kansas River Crossing", distance: 102, type: "river" },
            { name: "Big Blue River Crossing", distance: 185, type: "river" },
            { name: "Fort Kearney", distance: 304, type: "fort" },
            { name: "Chimney Rock", distance: 554, type: "landmark" },
            { name: "Fort Laramie", distance: 640, type: "fort" },
            { name: "Independence Rock", distance: 830, type: "landmark" },
            { name: "South Pass", distance: 932, type: "landmark" },
            { name: "Fort Bridger", distance: 1025, type: "fort" },
            { name: "Soda Springs", distance: 1180, type: "landmark" },
            { name: "Fort Hall", distance: 1288, type: "fort" },
            { name: "Snake River Crossing", distance: 1430, type: "river" },
            { name: "Fort Boise", distance: 1543, type: "fort" },
            { name: "Blue Mountains", distance: 1700, type: "landmark" },
            { name: "The Dalles", distance: 1850, type: "landmark" },
            { name: "Columbia River", distance: 1950, type: "river" },
            { name: "Oregon City", distance: 2000, type: "destination" }
        ];

        // Random events
        const events = [
            { text: "The weather is clear. Good traveling conditions!", effect: null },
            { text: "You found some berries along the trail!", effect: () => { gameState.food += 5; } },
            { text: "One of your oxen is sick.", effect: () => { gameState.health -= 10; } },
            { text: "You met friendly travelers who shared supplies!", effect: () => { gameState.food += 10; } },
            { text: "A storm slowed your progress.", effect: () => { gameState.health -= 5; } },
            { text: "Wagon wheel broke. Repairs needed.", effect: () => { gameState.money -= 10; } },
            { text: "Beautiful day for traveling!", effect: null },
            { text: "You found a good camping spot.", effect: () => { gameState.health += 5; } },
            { text: "Trail is muddy and difficult.", effect: () => { gameState.health -= 3; } },
            { text: "Found abandoned supplies!", effect: () => { gameState.food += 15; gameState.money += 5; } }
        ];

        const WATER_LEVELS = ["Shallow", "Medium", "Deep"];
        const CURRENT_STRENGTHS = ["Weak", "Moderate", "Strong"];

        function randomFrom(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function getRiverWaterLevel(riverName) {
            if (!gameState.riverWaterLevels[riverName]) {
                gameState.riverWaterLevels[riverName] = randomFrom(WATER_LEVELS);
            }
            return gameState.riverWaterLevels[riverName];
        }

        function rollCurrentStrength() {
            gameState.currentStrength = randomFrom(CURRENT_STRENGTHS);
            return gameState.currentStrength;
        }

        function getNextLandmark() {
            for (let landmark of landmarks) {
                if (gameState.distance < landmark.distance) return landmark;
            }
            return null;
        }

        // Initialize landmark markers on progress bar
        function initializeLandmarkMarkers() {
            const markersContainer = document.getElementById('landmarkMarkers');

            landmarks.forEach(landmark => {
                if (landmark.type === 'fort' || landmark.type === 'river') {
                    const position = (landmark.distance / GOAL_DISTANCE) * 100;
                    const marker = document.createElement('div');
                    marker.className = `landmark-marker marker-${landmark.type}`;
                    marker.style.left = `${position}%`;

                    const icon = document.createElement('div');
                    icon.className = 'marker-icon';
                    icon.textContent = landmark.type === 'fort' ? 'üè∞' : 'üåä';
                    marker.appendChild(icon);

                    markersContainer.appendChild(marker);
                }
            });
        }

        function checkForLandmark() {
            for (let landmark of landmarks) {
                if (gameState.distance >= landmark.distance &&
                    !gameState.visitedLandmarks.includes(landmark.name)) {

                    gameState.visitedLandmarks.push(landmark.name);
                    gameState.currentLandmark = landmark;
                    handleLandmarkArrival(landmark);
                    return;
                }
            }
        }

        function handleLandmarkArrival(landmark) {
            const landmarkDiv = document.getElementById('landmarkIndicator');
            gameState.awaitingChoice = true;

            if (landmark.type === "fort") {
                gameState.atFort = true;
                landmarkDiv.className = "landmark-indicator fort-stop";
                landmarkDiv.textContent = `üè∞ ${landmark.name}`;
                showFortChoices(landmark.name);
            } else if (landmark.type === "river") {
                gameState.atRiver = true;
                gameState.currentRiverName = landmark.name;
                landmarkDiv.className = "landmark-indicator river-crossing";
                landmarkDiv.textContent = `üåä ${landmark.name}`;
                showRiverChoices(landmark.name);
            } else if (landmark.type === "landmark") {
                landmarkDiv.className = "landmark-indicator landmark-choice";
                landmarkDiv.textContent = `üìç ${landmark.name}`;
                showLandmarkChoices(landmark.name);
            } else if (landmark.type === "destination") {
                landmarkDiv.className = "landmark-indicator victory";
                landmarkDiv.textContent = `üéâ ${landmark.name} - Journey's End!`;
                gameState.awaitingChoice = false;
            }
        }

        function showFortChoices(fortName) {
            showMessage(`You have arrived at ${fortName}! What would you like to do?`);

            const buttons = document.getElementById('actionButtons');
            buttons.innerHTML = `
                <button class="choice-button" onclick="fortChoice('trade')">Trade for Supplies ($20 for 40 lbs food)</button>
                <button class="choice-button" onclick="fortChoice('medicine')">Buy Medicine ($15, restore health)</button>
                <button class="choice-button" onclick="fortChoice('ox')">Buy an Ox ($25)</button>
                <button class="choice-button" onclick="fortChoice('rest')">Rest at the Fort (Free, recover health)</button>
                <button onclick="fortChoice('leave')">Leave and Continue Journey</button>
            `;
        }

        function fortChoice(choice) {
            gameState.day++;
            let message = "";

            switch(choice) {
                case 'trade':
                    if (gameState.money >= 20) {
                        gameState.money -= 20;
                        gameState.food += 40;
                        message = `Day ${gameState.day}: You traded $20 for 40 lbs of food.`;
                    } else {
                        message = "You don't have enough money! You need $20.";
                        gameState.day--;
                    }
                    break;
                case 'medicine':
                    if (gameState.money >= 15) {
                        gameState.money -= 15;
                        gameState.health += 20;
                        if (gameState.health > 100) gameState.health = 100;
                        message = `Day ${gameState.day}: You bought medicine and recovered 20% health.`;
                    } else {
                        message = "You don't have enough money! You need $15.";
                        gameState.day--;
                    }
                    break;
                case 'ox':
                    if (gameState.money >= 25) {
                        gameState.money -= 25;
                        gameState.oxen += 1;
                        message = `Day ${gameState.day}: You purchased a strong ox!`;
                    } else {
                        message = "You don't have enough money! You need $25.";
                        gameState.day--;
                    }
                    break;
                case 'rest':
                    gameState.health += 30;
                    if (gameState.health > 100) gameState.health = 100;
                    gameState.food -= 8;
                    message = `Day ${gameState.day}: You rested at the fort and recovered 30% health. Your party consumed 8 lbs of food.`;
                    break;
                case 'leave':
                    gameState.atFort = false;
                    gameState.awaitingChoice = false;
                    message = `Day ${gameState.day}: You leave the fort and continue on the trail.`;
                    restoreNormalButtons();
                    updateDisplay();
                    return;
            }

            showMessage(message);
            checkGameState();
            updateDisplay();
        }

        function showRiverChoices(riverName) {
            const waterLevel = getRiverWaterLevel(riverName);
            const currentStrength = rollCurrentStrength();

            showMessage(
                `You have reached the ${riverName}. The river is at a ${waterLevel} water level. The current today is ${currentStrength}. \n` +
                `How would you like to cross?`
            );

            const buttons = document.getElementById('actionButtons');
            buttons.innerHTML = `
                <button class="choice-button" onclick="riverChoice('ford')">Ford the River (Play mini-game)</button>
                <button class="choice-button" onclick="riverChoice('ferry')">Take the Ferry ($10, safer)</button>
                <button class="choice-button" onclick="riverChoice('wait')">Wait for Better Conditions (Uses time and food; current may change)</button>
            `;
        }

        function riverChoice(choice) {
            const riverName = gameState.currentRiverName;
            const waterLevel = getRiverWaterLevel(riverName);
            const currentStrength = gameState.currentStrength;

            switch(choice) {
                case 'ford':
                    startRiverCrossingGame(waterLevel, currentStrength);
                    return;

                case 'ferry':
                    gameState.day++;
                    if (gameState.money >= 10) {
                        gameState.money -= 10;
                        const message =
                            `Day ${gameState.day}: You took the ferry across. ` +
                            `(${waterLevel} water, ${currentStrength} current)\n` +
                            `Safe but costly. -$10`;

                        gameState.atRiver = false;
                        gameState.awaitingChoice = false;
                        gameState.currentRiverName = null;
                        gameState.currentStrength = null;

                        showMessage(message);
                        restoreNormalButtons();
                        checkGameState();
                        updateDisplay();
                    } else {
                        gameState.day--;
                        showMessage("You don't have enough money for the ferry! You'll have to ford or wait.");
                    }
                    return;

                case 'wait':
                    gameState.food -= 10;
                    gameState.day += 2;

                    const newCurrent = rollCurrentStrength();
                    const improvedText =
                        (newCurrent === "Weak") ? "Conditions look calmer now." :
                        (newCurrent === "Moderate") ? "Conditions are a bit better." :
                        "Still looks rough out there.";

                    showMessage(
                        `Day ${gameState.day}: You waited for better conditions. -10 lbs food, +2 days.\n` +
                        `${improvedText}\n` +
                        `The river is at a ${waterLevel} water level. The current today is ${newCurrent}.`
                    );

                    checkGameState();
                    updateDisplay();
                    return;
            }
        }

        function showLandmarkChoices(landmarkName) {
            let landmarkMessage = "";
            let choices = [];

            switch(landmarkName) {
                case "Chimney Rock":
                    landmarkMessage = "You've reached Chimney Rock, a towering natural monument!";
                    choices = [
                        { text: "Climb to get a better view", action: 'climb' },
                        { text: "Rest and admire from below", action: 'rest' },
                        { text: "Keep moving", action: 'continue' }
                    ];
                    break;
                case "Independence Rock":
                    landmarkMessage = "Independence Rock - travelers carve their names here!";
                    choices = [
                        { text: "Carve your name (takes time)", action: 'carve' },
                        { text: "Search for supplies left by others", action: 'search' },
                        { text: "Keep moving", action: 'continue' }
                    ];
                    break;
                case "South Pass":
                    landmarkMessage = "South Pass - the gateway through the Rocky Mountains!";
                    choices = [
                        { text: "Take the steep shortcut", action: 'shortcut' },
                        { text: "Take the longer safer route", action: 'safe' },
                        { text: "Rest before the climb", action: 'rest' }
                    ];
                    break;
                case "Soda Springs":
                    landmarkMessage = "Soda Springs - natural carbonated water springs!";
                    choices = [
                        { text: "Drink from the springs (health benefit)", action: 'drink' },
                        { text: "Fill containers with water", action: 'fill' },
                        { text: "Keep moving", action: 'continue' }
                    ];
                    break;
                case "Blue Mountains":
                    landmarkMessage = "The Blue Mountains - a challenging climb ahead!";
                    choices = [
                        { text: "Push through quickly", action: 'push' },
                        { text: "Take it slow and steady", action: 'slow' },
                        { text: "Rest before attempting", action: 'rest' }
                    ];
                    break;
                case "The Dalles":
                    landmarkMessage = "The Dalles - decision point for the final stretch!";
                    choices = [
                        { text: "Take the dangerous river route (faster)", action: 'river' },
                        { text: "Take the mountain route (slower but safer)", action: 'mountain' },
                        { text: "Rest and decide later", action: 'rest' }
                    ];
                    break;
                default:
                    landmarkMessage = `You've reached ${landmarkName}!`;
                    choices = [
                        { text: "Explore the area", action: 'explore' },
                        { text: "Rest here", action: 'rest' },
                        { text: "Keep moving", action: 'continue' }
                    ];
            }

            showMessage(landmarkMessage);

            const buttons = document.getElementById('actionButtons');
            buttons.innerHTML = choices.map(choice =>
                `<button class="choice-button" onclick="landmarkChoice('${landmarkName}', '${choice.action}')">${choice.text}</button>`
            ).join('');
        }

        function landmarkChoice(landmarkName, action) {
            gameState.day++;
            let message = "";

            switch(action) {
                case 'climb':
                    if (Math.random() > 0.6) {
                        gameState.health -= 5;
                        message = `Day ${gameState.day}: The climb was tiring but the view was spectacular! -5% health`;
                    } else {
                        gameState.health -= 10;
                        message = `Day ${gameState.day}: You slipped while climbing! Minor injuries. -10% health`;
                    }
                    break;
                case 'carve':
                    gameState.food -= 5;
                    gameState.day++;
                    message = `Day ${gameState.day}: You carved your name for posterity! Other travelers will see your mark. -5 lbs food, +1 day`;
                    break;
                case 'search':
                    if (Math.random() > 0.5) {
                        gameState.food += 10;
                        gameState.money += 5;
                        message = `Day ${gameState.day}: You found supplies left by previous travelers! +10 lbs food, +$5`;
                    } else {
                        message = `Day ${gameState.day}: You searched but found nothing of value.`;
                    }
                    break;
                case 'shortcut':
                    if (Math.random() > 0.5) {
                        gameState.distance += 40;
                        gameState.health -= 15;
                        message = `Day ${gameState.day}: The shortcut worked! You saved distance but it was exhausting. +40 miles, -15% health`;
                    } else {
                        gameState.health -= 25;
                        gameState.food -= 10;
                        message = `Day ${gameState.day}: The shortcut was a disaster! Very difficult terrain. -25% health, -10 lbs food`;
                    }
                    break;
                case 'safe':
                    gameState.food -= 8;
                    gameState.day++;
                    message = `Day ${gameState.day}: You took the safer route. It took longer but everyone is okay. -8 lbs food, +1 day`;
                    break;
                case 'drink':
                    gameState.health += 15;
                    if (gameState.health > 100) gameState.health = 100;
                    message = `Day ${gameState.day}: The mineral water was refreshing! +15% health`;
                    break;
                case 'fill':
                    gameState.food += 5;
                    message = `Day ${gameState.day}: You filled containers with water. This will help on the trail. +5 lbs food equivalent`;
                    break;
                case 'push':
                    if (Math.random() > 0.5) {
                        gameState.distance += 30;
                        gameState.health -= 15;
                        gameState.food -= 10;
                        message = `Day ${gameState.day}: You pushed through! Made good time but it was grueling. +30 miles, -15% health, -10 lbs food`;
                    } else {
                        gameState.health -= 25;
                        gameState.oxen -= 1;
                        message = `Day ${gameState.day}: Pushing too hard was a mistake! An ox died from exhaustion. -25% health, -1 ox`;
                    }
                    break;
                case 'slow':
                    gameState.food -= 12;
                    gameState.day += 2;
                    gameState.health -= 5;
                    message = `Day ${gameState.day}: Slow and steady. Everyone made it through safely. -12 lbs food, -5% health, +2 days`;
                    break;
                case 'river':
                    if (Math.random() > 0.6) {
                        gameState.distance += 50;
                        message = `Day ${gameState.day}: The river route was fast! Great choice. +50 miles`;
                    } else {
                        gameState.health -= 20;
                        gameState.food -= 15;
                        message = `Day ${gameState.day}: The river was treacherous! You made it but at great cost. -20% health, -15 lbs food`;
                    }
                    break;
                case 'mountain':
                    gameState.food -= 15;
                    gameState.day += 3;
                    gameState.health -= 10;
                    message = `Day ${gameState.day}: The mountain route was long but safe. -15 lbs food, -10% health, +3 days`;
                    break;
                case 'explore':
                    if (Math.random() > 0.6) {
                        gameState.food += 8;
                        message = `Day ${gameState.day}: You found some useful plants and berries! +8 lbs food`;
                    } else {
                        gameState.food -= 5;
                        message = `Day ${gameState.day}: You explored but didn't find much. -5 lbs food`;
                    }
                    break;
                case 'rest':
                    gameState.health += 15;
                    if (gameState.health > 100) gameState.health = 100;
                    gameState.food -= 8;
                    message = `Day ${gameState.day}: You rested. +15% health, -8 lbs food`;
                    break;
                case 'continue':
                    message = `Day ${gameState.day}: You continue on the trail without delay.`;
                    break;
            }

            gameState.awaitingChoice = false;
            showMessage(message);
            restoreNormalButtons();
            checkGameState();
            updateDisplay();
        }

        function restoreNormalButtons() {
            const buttons = document.getElementById('actionButtons');
            buttons.innerHTML = `
                <button onclick="travel()">Continue on Trail</button>
                <button onclick="rest()">Rest (Recover Health)</button>
                <button onclick="hunt()">Hunt for Food</button>
                <button onclick="trade()" id="tradeButton" disabled>Trade at Fort</button>
            `;
        }

        function updateDisplay() {
            document.getElementById('distance').textContent = `${gameState.distance} / ${GOAL_DISTANCE} miles`;
            document.getElementById('food').textContent = `${gameState.food} lbs`;
            document.getElementById('health').textContent = `${gameState.health}%`;
            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('oxen').textContent = gameState.oxen;

            const progress = (gameState.distance / GOAL_DISTANCE) * 100;
            document.getElementById('progressBar').style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('progressLabel').textContent = `${gameState.distance} miles`;

            const nextLandmark = getNextLandmark();
            if (nextLandmark && !gameState.atFort && !gameState.atRiver) {
                const distanceToNext = nextLandmark.distance - gameState.distance;
                const landmarkDiv = document.getElementById('landmarkIndicator');
                landmarkDiv.className = "landmark-indicator";
                landmarkDiv.textContent = `Next: ${nextLandmark.name} (${distanceToNext} miles)`;
            }
        }

        function showMessage(message) {
            document.getElementById('messageBox').textContent = message;
        }

        function travel() {
            if (gameState.gameOver || gameState.awaitingChoice) return;

            if (gameState.oxen <= 0) {
                showMessage("You have no oxen! You cannot continue. Game Over.");
                endGame(false);
                return;
            }

            if (gameState.atFort) gameState.atFort = false;

            const distance = Math.floor(Math.random() * 30) + 40;
            gameState.distance += distance;
            gameState.food -= 5;
            gameState.health -= 2;
            gameState.day++;

            const event = events[Math.floor(Math.random() * events.length)];
            let message = `Day ${gameState.day}: You traveled ${distance} miles. ${event.text}`;
            if (event.effect) event.effect();

            showMessage(message);
            checkForLandmark();
            checkGameState();
            updateDisplay();
        }

        function rest() {
            if (gameState.gameOver || gameState.awaitingChoice) return;

            const healthGain = gameState.atFort ? 30 : 20;
            gameState.health += healthGain;
            if (gameState.health > 100) gameState.health = 100;
            gameState.food -= 8;
            gameState.day++;

            const location = gameState.atFort ? "at the fort" : "on the trail";
            showMessage(`Day ${gameState.day}: You rested ${location} and recovered ${healthGain}% health. Your party consumed 8 lbs of food.`);
            checkGameState();
            updateDisplay();
        }

        function trade() {
            if (gameState.gameOver || !gameState.atFort || gameState.awaitingChoice) return;

            if (gameState.money < 20) {
                showMessage("You don't have enough money to trade!");
                return;
            }

            const choice = Math.random();
            gameState.day++;

            if (choice > 0.6) {
                gameState.money -= 20;
                gameState.food += 40;
                showMessage(`Day ${gameState.day}: You traded $20 for 40 lbs of food at the fort.`);
            } else if (choice > 0.3) {
                gameState.money -= 15;
                gameState.health += 15;
                if (gameState.health > 100) gameState.health = 100;
                showMessage(`Day ${gameState.day}: You bought medicine for $15 and restored some health.`);
            } else {
                gameState.money -= 25;
                gameState.oxen += 1;
                showMessage(`Day ${gameState.day}: You purchased a replacement ox for $25.`);
            }

            checkGameState();
            updateDisplay();
        }

        function checkGameState() {
            if (gameState.food <= 0) {
                showMessage("Your party has starved to death. Game Over.");
                endGame(false);
                return;
            }

            if (gameState.health <= 0) {
                showMessage("Your party has died from poor health. Game Over.");
                endGame(false);
                return;
            }

            if (gameState.distance >= GOAL_DISTANCE) {
                showMessage(`Congratulations! You made it to Oregon City in ${gameState.day} days! Your party survived the journey with ${gameState.food} lbs of food and ${gameState.health}% health remaining!`);
                endGame(true);
                return;
            }

            if (Math.random() < 0.05 && gameState.oxen > 0) {
                gameState.oxen--;
                showMessage(document.getElementById('messageBox').textContent + "\n\n‚ö†Ô∏è One of your oxen died!");
            }
        }

        function endGame(victory) {
            gameState.gameOver = true;
            const buttons = document.getElementById('actionButtons');
            buttons.style.display = 'flex';
            buttons.innerHTML = '<button onclick="location.reload()">Play Again</button>';

            const messageBox = document.getElementById('messageBox');
            messageBox.className = victory ? 'message-box victory' : 'message-box game-over';
        }

        // Initialize display
        initializeLandmarkMarkers();
        updateDisplay();
    </script>

    <!-- Mini-game modules (loaded after main game state and shared functions are defined) -->
    <script src="hunting.js"></script>
    <script src="river.js"></script>
</body>
</html>
